# Breaking Changes in Apache NiFi 2.x

In Apache NiFi 2.x, a number of previously deprecated components (processors, controller services, and reporting tasks) and features have been removed. For some of these components, alternatives are available in 1.x versions; for others, there are no direct replacements.

A list of all deprecated components, features, and available alternatives can be found on the Apache NiFi wiki page [here](https://cwiki.apache.org/confluence/display/NIFI/Deprecated+Components+and+Features).

The table below highlights changes in specific features and components and suggests actions to take for them before upgrading to 2.x. Some changes may require manual intervention, while others can be automated using provided upgrade scripts.

| Component or feature                                                        | Description                                                                                                                                                                                                                                                                                                                                                                                                             | Action type             | Actions |
|-----------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------|----------------------------|
| JoltTransformJSON                                                           | JoltTransformJSON has been moved to the `nifi-jolt-nar` NAR, and its properties have been renamed (e.g., `jolt-spec` to `Jolt Specification`, etc.) in 2.x.                                                                                                                                                                                                                                                             | Automated               | Ensure that during configuration import, the flow definition is upgraded using the [upgrade scripts](https://github.com/Netcracker/qubership-nifi/tree/main/dev/update-scripts-2.0). |
| DistributedMapCacheServer                                                   | This component was renamed to <code>MapCacheServer</code> in 2.x.                                                                                                                                                                                                                                                                                                                                                       | Automated               | Ensure that during configuration import, the flow definition is upgraded using the [upgrade scripts](https://github.com/Netcracker/qubership-nifi/tree/main/dev/update-scripts-2.0). |
| DistributedSetCacheServer                                                   | This component was renamed to <code>SetCacheServer</code> in 2.x.                                                                                                                                                                                                                                                                                                                                                       | Automated               | Ensure that during configuration import, the flow definition is upgraded using the [upgrade scripts](https://github.com/Netcracker/qubership-nifi/tree/main/dev/update-scripts-2.0). |
| DistributedMapCacheClientService                                            | This component was renamed to <code>MapCacheClientService</code> in 2.x.                                                                                                                                                                                                                                                                                                                                                | Automated               | Ensure that during configuration import, the flow definition is upgraded using the [upgrade scripts](https://github.com/Netcracker/qubership-nifi/tree/main/dev/update-scripts-2.0). |
| DistributedSetCacheClientService                                            | This component was renamed to <code>SetCacheClientService</code> in 2.x.                                                                                                                                                                                                                                                                                                                                                | Automated               | Ensure that during configuration import, the flow definition is upgraded using the [upgrade scripts](https://github.com/Netcracker/qubership-nifi/tree/main/dev/update-scripts-2.0). |
| Kafka-related components (ConsumeKafka_2_6, PublishKafka_2_6, etc.)         | Apache NiFi 2.x introduces completely new components (ConsumeKafka/PublishKafka + Kafka3ConnectionService) as replacements. Old components have been removed. Old NARs do not work on 2.x, and new NARs do not work on 1.x.                                                                                                                                                                                             | Manual (requires >=2.x) | <ol><li>Upgrade to Apache NiFi 2.x.</li><li>Update the flow to use the new Kafka components: create new processors and controller services and fill in their properties.</li><li>[Optional] If both 1.x and 2.x must be supported, two versions of the flow must be stored and maintained in parallel.</li></ol>|
| Variables                                                                   | Use Parameter Contexts (PCs) instead of variables. PCs are available since 1.10.                                                                                                                                                                                                                                                                                                                                        | Manual (requires >=1.10) | <ol><li>Create a parameter context (or several contexts, if needed).</li><li>Assign the PC(s) to the necessary process groups.</li><li>Change references in properties from <code>${varName}</code> to <code>#{paramName}</code>.</li></ol>|
| ConvertJSONToSql                                                            | Use RecordReader with PutDatabaseRecord or PutSQLRecord instead.                                                                                                                                                                                                                                                                                                                                                        | Manual                  | Update the flow to use new components:<ol><li>Create new components.</li><li>Fill in their properties based on the documentation and the properties from the old components.</li></ol>|
| `Proxy Host` and `Proxy Port` properties in `InvokeHTTP` processor          | Starting from 1.18.0, the `Proxy Configuration Service` property replaces the `Proxy Host` and `Proxy Port` properties in the `InvokeHTTP` processor. In 2.x, `Proxy Host` and `Proxy Port` properties were removed.                                                                                                                                                                                                    | Manual (requires >=1.18.0) | Update the flow to use the new property:<ol><li>Create a new Proxy Configuration Service.</li><li>Fill in its properties based on the documentation and the properties from the `InvokeHTTP` processor.</li></ol>|
| PrometheusReportingTask                                                     | PrometheusReportingTask is deprecated and removed in NiFi 2.x. Some metrics are available in the ComponentPrometheusReportingTask component. List of metrics: <ul><li>nifi_jvm_uptime</li><li>nifi_jvm_heap_usage</li><li>nifi_jvm_gc_time</li><li>nifi_jvm_thread_count</li><li>nifi_jvm_gc_runs</li><li>nifi_amount_items_queued</li><li>nifi_amount_threads_active</li><li>nifi_size_content_queued_total</li></ul>  | Manual (requires >=2.x) |  <ol><li>Remove PrometheusReportingTask from NiFi if it existed.</li><li>Add ComponentPrometheusReportingTask if it is missing.</li>                                                                                   |
| Cassandra-related components (e.g. PutCassandraQL) | Cassandra-related components were removed in 2.x version in favor of new implementation, which as of Apache NiFi 2.7.0 is not available yet. | Automated (requires qubership-nifi 2.3.1 or newer) | Upgrade to qubership-nifi 2.3.1 or newer. Starting from version 2.3.1 qubership-nifi contains Cassandra-related components from Apache NiFi 2.0.0-M2. |
| Other components/features with alternatives in the Apache NiFi [wiki](https://cwiki.apache.org/confluence/display/NIFI/Deprecated+Components+and+Features). | Use the alternative component/feature listed on the wiki instead.                                                                                                                                                                                                                                                                                                                                                       | Manual                  | Update the flow to use new components/features:<ol><li>Create new components (if needed).</li><li>Fill in new properties based on the documentation and properties from the old components.</li></ol>|
| Other components without alternatives in the Apache NiFi [wiki](https://cwiki.apache.org/confluence/display/NIFI/Deprecated+Components+and+Features). | The component was removed, possibly without replacement.                                                                                                                                                                                                                                                                                                                                                                | Manual                  | Research if any alternatives can be used instead. If not, create a custom component.|

## Upgrade Advisor

To help identify issues when upgrading to 2.x, the [Upgrade Advisor](https://github.com/Netcracker/qubership-nifi/blob/main/dev/upgrade-advisor) was created. Upgrade Advisor is a script that generates a report listing all deprecated components and features found in exported NiFi configurations.